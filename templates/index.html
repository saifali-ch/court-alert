<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link
            crossorigin="anonymous"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            rel="stylesheet"
    />
    <title>Court Alert</title>
    <style>
        .heading-1 {
            font-size: 36px;
            text-align: center;
            background: lightblue;
            border-radius: 10px;
            padding: 10px;
        }

        .heading-2 {
            font-size: 28px;
            text-align: center;
            background: lightblue;
            border-radius: 10px;
            padding: 10px;
        }

        .criteria-form {
            padding: 20px;
        }

    </style>
</head>
<body>
<div class="container p-4 col-6">
    <h1 class="heading-1">Court Alert Criteria</h1>
    <form class="criteria-form" method="POST">
        <input class="form-control" id="criteria_id" name="criteria_id" required type="hidden"/>
        <div class="mb-3">
            <label class="form-label" for="date">Date</label>
            <input class="form-control" id="date" name="date" required type="date"/>
        </div>

        <div class="mb-3">
            <label class="form-label" for="start_time">Start Time</label>
            <input class="form-control" id="start_time" name="start_time" required type="time"/>
        </div>

        <div class="mb-3">
            <label class="form-label" for="end_time">End Time</label>
            <input class="form-control" id="end_time" name="end_time" required type="time"/>
        </div>

        <div class="mb-3">
            <label for="duration">Duration (in minutes)</label>
            <select class="form-select" id="duration" name="duration" required>
                <option></option>
                <option value="30">30</option>
                <option value="60">60</option>
                <option value="90">90</option>
                <option value="120">120</option>
            </select>
        </div>

        <div class="form-check mb-4">
            <input class="form-check-input" id="active" name="active" type="checkbox" value="1">
            <label class="form-check-label" for="active">Active</label>
        </div>

        <div class="d-flex justify-content-end gap-5">
            <button class="btn btn-success" formaction="{{ url_for('add_criteria') }}" type="submit">
                Add Criteria
            </button>
            <button class="btn btn-primary" formaction="{{ url_for('update_criteria') }}" type="submit">
                Update Criteria
            </button>
        </div>
    </form>
    <br/>
    <div>
        <h2 class="heading-2">Current Criteria</h2>
        <table class="table table-success table-striped">
            <thead>
            <tr>
                <th class="text-center" scope="col">Active</th>
                <th scope="col">#</th>
                <th scope="col">Date</th>
                <th scope="col">Start Time</th>
                <th scope="col">End Time</th>
                <th class="text-center" scope="col">Duration</th>
                <th class="text-center" scope="col">Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for c in criteria %}
            <tr>
                <td class="d-flex justify-content-center">
                    <div class="form-check">
                        <input aria-label="Active" class="form-check-input"
                               onchange="toggleCriteria('{{ c[0] }}', this.checked)"
                               type="checkbox"
                               {{ 'checked' if c[5] == 1 else '' }}
                        >
                    </div>
                </td>
                <th>{{ loop.index }}</th>
                <td>{{ c[1].strftime('%Y-%m-%d') }}</td>
                <td>{{ c[2].strftime('%I:%M %p') }}</td>
                <td>{{ c[3].strftime('%I:%M %p') }}</td>
                <td class="text-center">{{ c[4] }}</td>
                <td class="text-center">
                    <a onclick="updateFormFields('{{ c[0] }}', this, '{{ c[5] }}')"
                       style="cursor: pointer">
                        <svg fill="#0B5ED7" height="20px" viewBox="0 0 32 32" width="20px"
                             xmlns="http://www.w3.org/2000/svg">
                            <title>Update</title>
                            <path d="M0 32l12-4 20-20-8-8-20 20zM4 28l2.016-5.984 4 4zM8 20l12-12 4 4-12 12z"></path>
                        </svg>
                    </a>
                    <a onclick="confirmDelete('{{ c[0] }}')" style="cursor: pointer">
                        <svg fill="none" height="20px" viewBox="0 0 24 24" width="20px"
                             xmlns="http://www.w3.org/2000/svg">
                            <title>Delete</title>
                            <path d="M10 11V17" stroke="#E55A54" stroke-linecap="round" stroke-linejoin="round"
                                  stroke-width="2"/>
                            <path d="M14 11V17" stroke="#E55A54" stroke-linecap="round" stroke-linejoin="round"
                                  stroke-width="2"/>
                            <path d="M4 7H20" stroke="#E55A54" stroke-linecap="round" stroke-linejoin="round"
                                  stroke-width="2"/>
                            <path d="M6 7H12H18V18C18 19.6569 16.6569 21 15 21H9C7.34315 21 6 19.6569 6 18V7Z"
                                  stroke="#E55A54" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                            <path d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z" stroke="#E55A54"
                                  stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                        </svg>
                    </a>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script
        crossorigin="anonymous"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
></script>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
<script>
    var today = new Date().toISOString().split('T')[0];
    document.getElementById("date").setAttribute('min', today);

    function updateFormFields(criteria_id, a, active) {
        var row = a.closest('tr');
        var date = row.cells[2].innerText;
        var start_time = row.cells[3].innerText;
        var end_time = row.cells[4].innerText;
        var duration = row.cells[5].innerText;

        start_time = moment(start_time, 'h:mm A').format('HH:mm');
        end_time = moment(end_time, 'h:mm A').format('HH:mm');

        console.log(criteria_id, date, start_time, end_time, duration, active)

        document.getElementById("criteria_id").value = criteria_id;
        document.getElementById("date").value = date;
        document.getElementById("start_time").value = start_time;
        document.getElementById("end_time").value = end_time;
        document.getElementById("duration").value = duration;
        document.getElementById("active").checked = parseInt(active);
    }

    function confirmDelete(criteriaId) {
        var confirmation = confirm("Are you sure you want to delete this criteria?");
        if (confirmation) {
            window.location.href = `/delete_criteria/${criteriaId}`;
        }
    }

    function toggleCriteria(criteriaId, isChecked) {
        var url = isChecked ? '/enable_criteria/' : '/disable_criteria/';
        url += criteriaId;

        fetch(url, {method: 'GET'})
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
    }
</script>
</html>
